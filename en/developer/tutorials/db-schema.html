<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Default database schema </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Default database schema ">
    <meta name="generator" content="docfx 2.59.4.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <link rel="preload" href="../../../fonts/fonts.css" )"="" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <meta property="docfx:navrel" content="/">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-7490022-8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-7490022-8');
    </script>
    <script>
      /*! loadCSS. [c]2017 Filament Group, Inc. MIT License
      - testing support for link[rel=preload]
      - enabling async CSS loading in browsers that do not support rel=preload
      - applying rel preload css once loaded, whether supported or not.
      */
      !function(n){"use strict";n.loadCSS||(n.loadCSS=function(){});var o=loadCSS.relpreload={};if(o.support=function(){var e;try{e=n.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),o.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},o.poly=function(){if(!o.support())for(var t=n.document.getElementsByTagName("link"),e=0;e<t.length;e++){var a=t[e];"preload"!==a.rel||"style"!==a.getAttribute("as")||a.getAttribute("data-loadcss")||(a.setAttribute("data-loadcss",!0),o.bindMediaToggle(a))}},!o.support()){o.poly();var t=n.setInterval(o.poly,500);n.addEventListener?n.addEventListener("load",function(){o.poly(),n.clearInterval(t)}):n.attachEvent&&n.attachEvent("onload",function(){o.poly(),n.clearInterval(t)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:n.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
    </script>
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="170">
    <div id="wrapper">
      <header>
        <div class="container">
          <div id="header" class="header navbar-header">
            <div class="header-logo">
              <a href="https://preprod.nitrosmart.app/">
                <img id="logo" class="svg" src="../../../logo.png" alt="">
              </a>
            </div>  </div>
          <div class="navbar-collapse collapse in">
            <form class="navbar-form navbar-right" role="search" id="search">
              <div class="form-group">
                <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
              </div>
        
              <div class="form-group lang-container">
                    
                    <select id="lang-switcher" class="select-css">
                        <option value="/en/index.html" selected="">
                          English
                        
                    </select>        </div>
            </form>
          </div>
        </div>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="en/developer/tutorials/db-schema">
<h1 id="default-database-schema">Default database schema</h1>

<p>In this article, we will look at the database schema that is installed during initial installation and which remains unchanged in 90% of cases.</p>
<p>We won't bring the entire schema as a whole but will describe the default installation that provides for the creation of 126 tables.</p>
<p>To understand such a scheme easily let's split it into parts. Below, we grouped the tables most naturally and understandably:</p>
<ul>
<li><a href="#customers-info">Customers info</a></li>
<li><a href="#products-info">Products info</a>
<ul>
<li><a href="#product-attributes">Product attributes</a></li>
<li><a href="#tier-price">Tier price</a></li>
<li><a href="#inventory-by-warehouses">Inventory by warehouses</a></li>
</ul>
</li>
<li><a href="#orders">Orders</a></li>
<li><a href="#shipments">Shipments</a></li>
<li><a href="#discounts">Discounts</a></li>
<li><a href="#shopping-cart">Shopping cart</a></li>
<li><a href="#addresses">Addresses</a></li>
<li><a href="#database-naming-convention">Database naming convention</a></li>
</ul>
<h2 id="customers-info">Customers info</h2>
<p><img src="static/db-schema/customers-info.jpg" alt="Customers info"></p>
<p>This diagram shows a set of tables that contain basic customer information. It also indicates the direction of links.</p>
<p>We won't delve into the purpose of tables and fields, since their names are self-descriptive enough.</p>
<h3 id="features-customers-info">Features (Customers info)</h3>
<ul>
<li><p>In the <strong>Customer</strong> table we have three fields which in fact should be defined as foreign keys but in practice, they are not:</p>
<ol>
<li>AffiliateId</li>
<li>VendorId</li>
<li>RegisteredInStoreId</li>
</ol>
<p>This is done intentionally so as not to overload the system with unnecessary connections, since these fields are not used in every online store.</p>
</li>
<li><p>Some of the user data is stored in the <strong>GenericAttribute</strong> table. You can find all of them at <code>\src\Libraries\Nop.Core\Domain\Customers\NopCustomerDefaults.cs</code>.</p>
<p>The structure of this table is presented below:</p>
<p><img src="static/db-schema/generic-attribute.jpg" alt="GenericAttribute"></p>
<p>Besides the mentioned customer data, this table can store any data for other entities as well. We added this table on purpose so that you could extend any entity without changing the structure of the tables.</p>
<p>Additionally, this table stores custom <strong>Customer attributes</strong> and <strong>Vendor attributes</strong> with the chosen values for vendors and customers in the XML format. See the following rows to understand what it looks like:</p>
<p><img src="static/db-schema/xml.jpg" alt="Xml"></p>
<p>On the example of the XML string from the <em>Value</em> column we can see how exactly the attribute values are stored for a certain vendor:</p>
<pre><code class="lang-csharp">&lt;Attributes&gt;&lt;VendorAttribute ID=&quot;2&quot;&gt;&lt;VendorAttributeValue&gt;&lt;Value&gt;1&lt;/Value&gt;&lt;/VendorAttributeValue&gt;&lt;/VendorAttribute&gt;&lt;/Attributes&gt;
</code></pre>
<p>As you can see the vendor with ID 1 has only one vendor attribute filled. This attribute has ID 2 and its value is 1.</p>
<p>Custom customer attributes have the same structure as vendor attributes. The following screenshot represents the relationships between <strong>Customer attributes</strong> and <strong>Vendor attributes</strong> and their values:</p>
<p><img src="static/db-schema/attributes.jpg" alt="Xml"></p>
</li>
</ul>
<h2 id="products-info">Products info</h2>
<p><img src="static/db-schema/products-info.jpg" alt="Products info"></p>
<p>In the diagram, you can see the base data for the product (the schema of the product information table below). As a rule, this data is used in 99% of cases.</p>
<p><img src="static/db-schema/product.png" alt="Product table"></p>
<h3 id="features-products-info">Features (Products info)</h3>
<p>Depending on the store settings, additional tables may be connected to this scheme. For example, to distribute product quantity among multiple warehouses.</p>
<p><img src="static/db-schema/warehouse.jpg" alt="Product table"></p>
<p>Or if you want to use the product reviews functionality:</p>
<p><img src="static/db-schema/product-review.jpg" alt="Product table"></p>
<h3 id="product-attributes">Product attributes</h3>
<p>Then let's consider the scheme of attributes and their combinations presented below:</p>
<p><img src="static/db-schema/product-attributes.jpg" alt="Product attributes"></p>
<h3 id="tier-price">Tier price</h3>
<p>If you use tier pricing for products you should also pay attention to the following scheme:</p>
<p><img src="static/db-schema/tier-price.jpg" alt="Tier price"></p>
<h3 id="inventory-by-warehouses">Inventory by warehouses</h3>
<p>Although this feature is not used often, it might be useful to give a scheme for accounting for goods in a particular warehouse:</p>
<p><img src="static/db-schema/stock-quantity-history.jpg" alt="Inventory by warehouses"></p>
<h2 id="orders">Orders</h2>
<p><img src="static/db-schema/orders.jpg" alt="orders"></p>
<p>In this diagram, we can see the tables related to the order data. The <strong>Order</strong> table has the following structure:</p>
<p><img src="static/db-schema/order.png" alt="order"></p>
<p>There is no need to comment on anything since everything should be clear from the diagram and the names of the fields are self-descriptive enough. It should only be noted that the <strong>RewardPointsHistory</strong> table is used only if the <em>Reward points system</em> is activated for the store.</p>
<h2 id="shipments">Shipments</h2>
<p><img src="static/db-schema/shipments.jpg" alt="shipments"></p>
<p>The purpose of all tables in the diagram, as before, raises no questions. Nevertheless, let's dwell on a few points. The <strong>ShippingMethod</strong> table is used to manage the list of connected plugins, and the specific shipping method is stored in the <em>ShippingRateComputationMethodSystemName</em> and <em>ShippingMethod</em> fields of the <strong>Order</strong> table.</p>
<p>The <em>OrderItemId</em> field of the <strong>ShipmentItem</strong> table is essentially a reference to the <strong>OrderItem</strong> table.</p>
<h2 id="discounts">Discounts</h2>
<p><img src="static/db-schema/discounts.jpg" alt="discounts"></p>
<p>From the diagram above, we can see that discounts can be applied to three groups: <strong>Products</strong>, <strong>Manufacturers</strong>, <strong>Categories</strong>
And can be configured with various rules which are controlled by plugins (<code>IDiscountRequirementRule</code>).</p>
<p>In the <strong>DiscountRequirement</strong> table, the <em>InteractionTypeId</em> field must contain one of the values specified in the <code>RequirementGroupInteractionType</code> enumeration:</p>
<pre><code class="lang-csharp">/// &lt;summary&gt;
/// Represents an interaction type within the group of requirements
/// &lt;/summary&gt;
public enum RequirementGroupInteractionType
{
    /// &lt;summary&gt;
    /// All requirements within the group must be met
    /// &lt;/summary&gt;
    And = 0,

    /// &lt;summary&gt;
    /// At least one of the requirements within the group must be met 
    /// &lt;/summary&gt;
    Or = 2
}
</code></pre>
<h2 id="shopping-cart">Shopping cart</h2>
<p>Another important part of the store is a shopping cart. In our case the scheme of this mechanism is very simple:</p>
<p><img src="static/db-schema/shopping-cart-item.jpg" alt="Shopping cart"></p>
<p>The only thing worth noting is that this scheme is also used for a wishlist. To separate these two types, the <em>ShoppingCartTypeId</em> field is used. The values in this field must match the values from the <strong>ShoppingCartType</strong> enumeration:</p>
<pre><code class="lang-csharp">/// &lt;summary&gt;
/// Represents a shopping cart type
/// &lt;/summary&gt;
public enum ShoppingCartType
{
    /// &lt;summary&gt;
    /// Shopping cart
    /// &lt;/summary&gt;
    ShoppingCart = 1,

    /// &lt;summary&gt;
    /// Wishlist
    /// &lt;/summary&gt;
    Wishlist = 2
}
</code></pre>
<h2 id="addresses">Addresses</h2>
<p>Perhaps you will also be interested in the table schema involved in storing addresses, both delivery, and the customer addresses:</p>
<p><img src="static/db-schema/addresses.jpg" alt="addresses"></p>
<p>As you understand, the standard installation includes much more tables. We don't describe them all, since many of them have no connections and serve only for a specific purpose, while others are used very rarely.</p>
<h2 id="database-naming-convention">Database naming convention</h2>
<p>You may have noticed that the database uses a mixed approach to naming of tables and columns (with <code>_</code> char, without <code>_</code>, CamelCase). Long time ago we used <code>_</code> char. But now we've completely switched to using <strong>CamelCase</strong> notation. But we decide not to change names of the existing tables or columns because many of our users already could write a huge amount of their custom scripts that would inevitably stop working.</p>
<p>For backward compatibility with the new standards, we added the <code>INameCompatibility</code> interface which allows you to redefine the names of tables and columns for the correct mapping of objects with tables created according to the old naming standards. You can see the complete list of overrides in the <a href="https://github.com/nopSolutions/nopCommerce/blob/develop/src/Libraries/Nop.Data/Mapping/BaseNameCompatibility.cs">BaseNameCompatibility</a> class from the <code>Nop.Data.Mapping</code> namespace.</p>

                  <div class="course-banner">
                      <a target="_blank" href="https://www.nopcommerce.com/training?utm_source=docs_nopcommerce&utm_medium=documentation&utm_campaign=course&utm_content=Developers_Guide">
                          <div class="course-banner-left"></div>
                          <div class="course-banner-center">
                              <div class="course-banner-title"><span>nopCommerce training course</span></div>
                              <div class="course-banner-description"><span>Start developing your skills and become a Certified Developer</span></div>
                          </div>
                          <div class="course-banner-right"></div>
                      </a> 
                  </div>            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/nopSolutions/NitroSmartDocs/blob/master/en/developer/tutorials/db-schema.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
